<!doctype html><html lang=en-US><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://megate.ch/index.xml title=Megatech><meta name=author content="Alexander Rothman"><meta name=keywords content="mandelbrot set,opengl,sdl2,c++,c++20"><meta name=description content="Drawing the Mandelbrot set."><meta name=generator content="Hugo 0.131.0"><title>Megatech - Mandelbrot Set</title><style>body,html{height:100%;width:100%}@media(prefers-color-scheme:light){:root{--bg:#fbf1c7;--bg0_hard:#f9f5d7;--bg0_soft:#f2e5bc;--bg0:#fbf1c7;--bg1:#ebdbb2;--bg2:#d5c4a1;--bg3:#bdae93;--bg4:#a89984;--fg:#3c3836;--fg0:#282828;--fg1:#3c3836;--fg2:#504945;--fg3:#665c54;--fg4:#7c6f64;--red:#cc241d;--highlight-red:#9d0006;--green:#98971a;--highlight-green:#79740e;--yellow:#d79921;--highlight-yellow:#b57614;--blue:#458588;--highlight-blue:#076678;--purple:#b16286;--highlight-purple:#8f3f71;--aqua:#689d6a;--highlight-aqua:#427b58;--gray:#7c6f54;--highligh-gray:#928374;--orange:#d65d0e;--highlight-orange:#af3a03;--navigation-shadow:var(--fg4);--navigation-text:var(--fg);--gutter-bg:var(--bg0_soft);--main-bg:var(--bg0_hard);--main-fg:var(--fg);--image-shadow:var(--fg4)}}@media(prefers-color-scheme:dark){:root{--bg:#282828;--bg0_hard:#1d2021;--bg0_soft:#32302f;--bg0:#282828;--bg1:#3c3836;--bg2:#504945;--bg3:#665c54;--bg4:#7c6f64;--fg:#ebdbb2;--fg0:#fbf1c7;--fg1:#ebdbb2;--fg2:#d5c4a1;--fg3:#bdae93;--fg4:#a89984;--red:#cc241d;--highlight-red:#fb4934;--green:#98971a;--highlight-green:#b8bb26;--yellow:#d79921;--highlight-yellow:#fabd2f;--blue:#458588;--highlight-blue:#83a598;--purple:#b16286;--highlight-purple:#d3869b;--aqua:#689d6a;--highlight-aqua:#8ec07c;--gray:#a09984;--highligh-gray:#928374;--orange:#d65d0e;--highlight-orange:#fe8019;--navigation-shadow:var(--bg0_hard);--navigation-text:var(--fg4);--gutter-bg:var(--bg0);--main-bg:var(--bg0_soft);--main-fg:var(--fg4);--image-shadow:var(--bg0_hard)}}body{background-color:var(--main-bg);color:var(--main-fg)}@font-face{font-family:fira sans;src:local('Fira Sans Hair'),url(/typefaces/woff2/FiraSans-Hair.woff2)format('woff2');font-weight:100;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Hair Italic'),url(/typefaces/woff2/FiraSans-HairItalic.woff2)format('woff2');font-weight:100;font-style:italic;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans UltraLight'),url(/typefaces/woff2/FiraSans-UltraLight.woff2)format('woff2');font-weight:200;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans UltraLight Italic'),url(/typefaces/woff2/FiraSans-UltraLightItalic.woff2)format('woff2');font-weight:200;font-style:italic;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Light'),url(/typefaces/woff2/FiraSans-Light.woff2)format('woff2');font-weight:300;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Light Italic'),url(/typefaces/woff2/FiraSans-LightItalic.woff2)format('woff2');font-weight:300;font-style:italic;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Regular'),url(/typefaces/woff2/FiraSans-Regular.woff2)format('woff2');font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Regular Italic'),url(/typefaces/woff2/FiraSans-Italic.woff2)format('woff2');font-weight:400;font-style:italic;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Medium'),url(/typefaces/woff2/FiraSans-Medium.woff2)format('woff2');font-weight:500;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Medium Italic'),url(/typefaces/woff2/FiraSans-MediumItalic.woff2)format('woff2');font-weight:500;font-style:italic;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans SemiBold'),url(/typefaces/woff2/FiraSans-SemiBold.woff2)format('woff2');font-weight:600;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans SemiBold Italic'),url(/typefaces/woff2/FiraSans-SemiBoldItalic.woff2)format('woff2');font-weight:600;font-style:italic;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Bold'),url(/typefaces/woff2/FiraSans-Bold.woff2)format('woff2');font-weight:700;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Bold Italic'),url(/typefaces/woff2/FiraSans-BoldItalic.woff2)format('woff2');font-weight:700;font-style:italic;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans ExtraBold'),url(/typefaces/woff2/FiraSans-ExtraBold.woff2)format('woff2');font-weight:800;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans ExtraBold Italic'),url(/typefaces/woff2/FiraSans-ExtraBoldItalic.woff2)format('woff2');font-weight:800;font-style:italic;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Heavy'),url(/typefaces/woff2/FiraSans-Heavy.woff2)format('woff2');font-weight:900;font-style:normal;font-display:swap}@font-face{font-family:fira sans;src:local('Fira Sans Heavy Italic'),url(/typefaces/woff2/FiraSans-HeavyItalic.woff2)format('woff2');font-weight:900;font-style:italic;font-display:swap}@font-face{font-family:fira mono;src:local('Fira Mono'),url(/typefaces/woff2/FiraMono-Regular.woff2)format('woff2');font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:fira mono;src:local('Fira Mono Bold'),url(/typefaces/woff2/FiraMono-Bold.woff2)format('woff2');font-weight:600;font-style:normal;font-display:swap}@font-face{font-family:fira code;src:url(/typefaces/woff2/FiraCode-Light.woff2)format('woff2');font-weight:300;font-style:normal;font-display:swap}@font-face{font-family:fira code;src:url(/typefaces/woff2/FiraCode-Regular.woff2)format('woff2');font-weight:400;font-style:normal;font-display:swap}@font-face{font-family:fira code;src:url(/typefaces/woff2/FiraCode-Medium.woff2)format('woff2');font-weight:500;font-style:normal;font-display:swap}@font-face{font-family:fira code;src:url(/typefaces/woff2/FiraCode-SemiBold.woff2)format('woff2');font-weight:600;font-style:normal;font-display:swap}@font-face{font-family:fira code;src:url(/typefaces/woff2/FiraCode-Bold.woff2)format('woff2');font-weight:700;font-style:normal;font-display:swap}body{font-family:fira sans,sans-serif}code{font-family:fira code,fira mono,monospace;font-size:10pt;font-weight:700;font-variant-ligatures:none}body{margin:0}div.grid-container{display:grid;margin:1in 0;border:0;grid-template-areas:"left middle right" "left middle right" "left middle right"}@media only screen and (max-width:8.5in){div.grid-container{grid-template-columns:0% 100% 0%}div.grid-left-column,div.grid-right-column{display:none}}@media only screen and (min-width:8.51in){div.grid-container{grid-template-columns:auto 8.5in auto}}div.grid-left-column{grid-area:left}div.grid-middle-column{grid-area:middle}div.grid-right-column{grid-area:right}div.nav-grid-container{margin:auto .5rem;display:grid;grid-template-areas:"navigation icons";grid-template-columns:1fr auto;column-gap:1rem}div.nav-grid-container nav{grid-area:navigation}div.nav-grid-container nav.icons{grid-area:icons;user-select:none}.center-text{text-align:center}.small{font-size:10pt}.smaller{font-size:8pt}.monospace{font-family:fira mono,monospace}.sans-serif{font-family:fira sans,sans-serif}body{font-size:12pt}main{margin-left:.2in;margin-right:.2in}hr{border-color:var(--main-fg);background-color:var(--main-fg);border-style:solid;border-width:2px}span.nowrap{white-space:nowrap}nav>a{font-size:14pt}a{text-decoration:none}a:hover,a:visited:hover{text-decoration:underline;text-decoration-style:wavy}@media(prefers-color-scheme:dark){a:link{color:var(--highlight-orange)}a:hover,a:visited:hover{color:var(--highlight-orange)}a:active,a:visited:active{color:var(--highlight-purple)}a:visited{color:var(--orange)}}@media(prefers-color-scheme:light){a:link{color:var(--red)}a:hover,a:visited:hover{color:var(--red)}a:active,a:visited:active{color:var(--highlight-purple)}a:visited{color:var(--highlight-red)}}h1.backref,h2.backref,h3.backref,h4.backref,h5.backref,h6.backref{display:grid;grid-template:"heading anchor";grid-template-columns:minmax(auto,1fr)auto;justify-content:left;column-gap:1rem;white-space:nowrap}span.backref-heading{grid-area:heading}span.backref-anchor{grid-area:anchor;justify-content:right;font-family:fira code,fira mono,monospace}a.backref{-webkit-user-select:none;user-select:none}a.backref:hover,a.backref:visited:hover{text-decoration:none}@media(prefers-color-scheme:dark){a.backref:link{color:var(--bg1)}a.backref:hover,a.backref:visited:hover{color:var(--highlight-orange)}a.backref:visited{color:var(--bg2)}}@media(prefers-color-scheme:light){a.backref:link{color:var(--bg1)}a.backref:hover,a.backref:visited:hover{color:var(--red)}a.backref:visited{color:var(--bg1)}}h1.title{font-size:36pt}a.icon,a.icon:hover,a.icon:active,a.icon:visited,a.icon:link{text-decoration:none}img.icon{display:inline-flex;max-width:14pt;vertical-align:middle;aspect-ratio:1/1}picture.framed img{color:inherit;display:block;border:outset;border-color:var(--main-fg);margin:auto;max-width:100%}picture img.aspect-16-9{aspect-ratio:16/9}picture img.aspect-4-3{aspect-ratio:4/3}canvas#cube-context{display:block;margin:auto;max-width:100%;height:auto}pre{font-size:10pt;text-align:left;border-color:var(--fg);border:outset;margin:auto;max-width:120ch;white-space:pre-wrap}pre code.hljs{padding:.12in}pre code{font-weight:400;background-color:inherit;padding:inherit;border-radius:inherit}main{margin-bottom:.5in}span.epigraph{display:block;text-align:justify}span.epigraph-attribution{display:block;text-align:right}ul>li{margin-bottom:.33rem}dl.footnotes{display:grid;grid-template-areas:"id text";column-gap:1rem;font-size:9pt}dl.footnotes>dt::after{content:"."}dl.footnotes>dd{margin:auto}</style><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","articleSection":"projects","author":[{"@type":"Person","alternateName":"gnomesort","email":"gnomesort@megate.ch","name":"Alexander Rothman","url":"https://megate.ch/"}],"dateModified":"2024-10-25T00:00:00Z","datePublished":"2024-10-25T00:00:00Z","headline":"Mandelbrot Set","wordCount":1050}</script></head><body><div class=grid-container><div class=left-column></div><div class=middle-column><header><hr><h1 class="title center-text">Megatech</h1><div class=nav-grid-container><nav><a href=https://megate.ch/>~</a>&nbsp;/
<a href=https://megate.ch/code/>code</a>&nbsp;/
<a href=https://megate.ch/portfolio/>portfolio</a>&nbsp;/
<a href=https://megate.ch/projects/>projects</a>&nbsp;/</nav><nav class=icons><a class=icon href=https://github.com/gn0mesort><picture><source srcset=/img/svg/github_mark_white.svg media="(prefers-color-scheme: dark)"><img class=icon alt=Github aria-label=Github src=/img/svg/github_mark.svg>
</picture></a><a class=icon href=https://megate.ch/index.xml><picture><img class=icon alt="RSS Feed" aria-label="RSS Feed" src=/img/svg/rss.svg></picture></a></nav></div><hr></header><main><h1 class=center-text>Mandelbrot Set</h1><h4 class=center-text><time datetime=2024-10-25>October 25, 2024</time></h4><aside><h2>Outline</h2><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a></li><li><a href=#the-problem>The Problem</a></li><li><a href=#the-solution>The Solution</a></li><li><a href=#thoughts>Thoughts</a></li></ul></nav></aside><article><h2 class=backref id=introduction><span class=backref-heading>Introduction</span><aside><span class=backref-anchor><a class=backref href=#introduction>&lt;==</a></span></aside></h2><p>I didn&rsquo;t think I&rsquo;d be writing anything this soon after my last post. I was starting to brainstorm some game ideas,
because that&rsquo;s what I wanted to do. Then outside forces kind of led me astray. At first, I just wanted to get back
to rendering something. Then, I had a pretty bad day on Sunday (<span class=nowrap>October 20, 2024</span>). I
guess, I was just in a weird mood and I decided to work it out by staying up all night (I didn&rsquo;t go to sleep until
around 10:00 the next day). I spent most of the night writing <a href=https://github.com/gn0mesort/mandelbrot-set>a program</a>
that draws the <a href=https://en.wikipedia.org/wiki/Mandelbrot_set>Mandelbrot set</a> fractal. The result worked acceptably,
but I decided I could do a bit better if I gave it a few more days of work. That&rsquo;s what I ended up doing, and here we
are.</p><a href=/img/mandelbrot_1_1920x1080.png><picture class=framed><img alt="An image of a fractal." class=aspect-16-9 src=/img/mandelbrot_1_640x360.avif></picture></a><h2 class=backref id=the-problem><span class=backref-heading>The Problem</span><aside><span class=backref-anchor><a class=backref href=#the-problem>&lt;==</a></span></aside></h2><p>I wasn&rsquo;t really in the frame of mind to think about, like, software requirements when I started this project. Here&rsquo;s
the basic idea though.</p><p>First off, the goal was to write a hardware accelerated version of one of the basic
<a href=https://en.wikipedia.org/wiki/Plotting_algorithms_for_the_Mandelbrot_set>plotting algorithms for the Mandelbrot set</a>.
I&rsquo;ve always thought of this kind of thing as being a sort of elite high math topic, perhaps only accessible to some
sort of math elves, but the computation isn&rsquo;t actually that complex. Secondly, I wanted to do this with
<a href=https://www.opengl.org/>OpenGL</a> and <a href=https://www.libsdl.org/>SDL</a> instead of having a weird obsessive need to
maximize my burden with <a href=https://www.vulkan.org/>Vulkan</a> (and maybe <a href=https://www.x.org/wiki/>X11</a>). Finally, after
completing my all-night session I wanted to ensure the resulting software was presentable and polished enough that I
could call it complete.</p><a href=/img/mandelbrot_2_1920x1080.png><picture class=framed><img title="Be wary of Elden Ring" alt="An image of a fractal." class=aspect-16-9 src=/img/mandelbrot_2_640x360.avif></picture></a><h2 class=backref id=the-solution><span class=backref-heading>The Solution</span><aside><span class=backref-anchor><a class=backref href=#the-solution>&lt;==</a></span></aside></h2><p>Ok, I&rsquo;m going to go point by point here too.</p><p>To get the actual image drawn, I implemented a screen-space approach. The computation happens in the fragment shader
and it&rsquo;s a two-step process. First, the shader computes a recursive series defined as
<code>z<sub>0</sub> = (0, 0), z<sub>n</sub> = z<sub>n-1</sub><sup>2</sup> + c</code>.
Here, <code>c</code> is the two-dimensional coordinate of the fragment on the screen. The shader does some preprocessing to map
the discrete coordinate into range and to adjust for the camera&rsquo;s position too. If the series diverges to infinity
(i.e., <code>|z<sub>n</sub>| > 2<sup>16</sup></code>) or the shader reaches the 1000<sup>th</sup> term, the
first step ends. The second step is simpler. Using the last computed term, the shader maps the term&rsquo;s index to a
color in a 256-color palette. The specific palette I chose is called
<a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0199239">Cividis</a>. There&rsquo;s also a black and white
variant where coordinates that diverge to infinite are black and finite coordinates are white.</p><p>Despite my initial view that this was some real MIT/Berkeley/Stanford-level stuff, it isn&rsquo;t really that much math. I
won&rsquo;t pretend I get it, but the implementation is straight-forward.</p><a href=/img/mandelbrot_3_1920x1080.png><picture class=framed><img alt="An image of a fractal." class=aspect-16-9 src=/img/mandelbrot_3_640x360.avif></picture></a><p>On the CPU-side of the application, I used SDL2 and OpenGL 4.5 (loaded via <a href=https://github.com/Dav1dde/glad>Glad</a>). I
have plenty of complaints about this, but it really was the right choice. If I had gone with Vulkan and directly
fiddling with X11 it would have taken me a month or more to finish. As usual, with C APIs like these, a lot of the
program is just about handling their inconsistent error mechanisms. Initially, I wrote the application with no error
handling at all. Instead of checking info logs to determine why my shader didn&rsquo;t work, at various points, I just ran
<a href=https://renderdoc.org/>Renderdoc</a> (compiling this from source was tricky) and prayed. After my all-night jam
session, I went back and added all the error handling. It&rsquo;s nothing special. If any call to SDL or OpenGL fails, the
application just bails out.</p><a href=/img/mandelbrot_4_1920x1080.png><picture class=framed><img alt="An image of a fractal." class=aspect-16-9 src=/img/mandelbrot_4_640x360.avif></picture></a><p>As far as structure, the program is pretty normal. It starts with initializing SDL and creating an OpenGL context.
Next, I prepare my shaders, a vertex array, and vertex and index buffers. This is all just to draw a rectangle to the
entire drawable area. This first phase of the program also sets up some miscellaneous OpenGL stuff (e.g., setting the
clear color to gray, enabling <a href=https://en.wikipedia.org/wiki/Multisample_anti-aliasing>MSAA</a>, and enabling
<a href=https://en.wikipedia.org/wiki/SRGB>sRGB</a> conversion). Next, the application enters its main loop. Again, the loop is
pretty standard stuff. I (stack) allocate a bunch of variables for various controls and conditions. At the top of the
loop I compute the delta-time of the frame and render the current frame from scratch. After that, I collect input from
SDL, and update my control state. The loop ends by updating the camera&rsquo;s position. When the loop is broken, the
program ends with tear down.</p><p>The last bit of any real interest is the code that updates the camera based on the state of the controls. My initial
implementation didn&rsquo;t have controls at all. Instead, the view would just zoom in and out based on the program&rsquo;s run
time. That kind of sucked though because a user couldn&rsquo;t zoom in on all the fine details of the fractal. To improve
things I added simple controls which were triggered directly by SDL events. It was a serviceable implementation, but
it wasn&rsquo;t smooth because it wasn&rsquo;t delta-timed. Instead, the camera just teleported around. To smooth things out, I
created a little extra state for the keyboard controls, added proper delta-timing, and ensured zoom changes were
linearly interpolated. I think the results are pretty smooth.</p><h2 class=backref id=thoughts><span class=backref-heading>Thoughts</span><aside><span class=backref-anchor><a class=backref href=#thoughts>&lt;==</a></span></aside></h2><p>Based on what I said in the introduction, it should be obvious that this project didn&rsquo;t really come from a good
place. I was really feeling down on myself and I needed a win to get back in the right mindset. Now, I&rsquo;m feeling
alright, so the project did its job. I still want to do something more significant, but it&rsquo;s really hard to focus
on all the boilerplate for Vulkan when I&rsquo;m struggling in other ways. Game design is like that for me too. I don&rsquo;t want
to just cowboy another little terminal game. I want to make something half-way decent, but even a thin slice of a
half-way decent game requires a lot of design work.</p><p>I&rsquo;m happy that I made something that I think is beautiful for once, but it&rsquo;s still not good enough for me. A lot of
the time I wonder, are the barriers really self-imposed? Is pizza, Diet Coke, and a cheap PC really all I need to make
it? It sure feels like millions of dollars of capitalization would make things easier.</p><a href=/img/mandelbrot_5_1920x1080.png><picture class=framed><img alt="An image of a fractal." class=aspect-16-9 src=/img/mandelbrot_5_640x360.avif></picture></a></article></main><footer><hr><nav class=center-text><a href=#>top</a></nav><hr></footer></div><div class=right-column></div></div></body></html>